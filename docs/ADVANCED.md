# üöÄ Advanced Configuration Guide

This guide covers advanced use cases and customization options for power users.

## üìÖ Multiple Daily Reports

Run different configurations at different times of day.

### Morning Brief (6 AM)
```javascript
function morningBrief() {
  // Lighter config for morning reading
  const MORNING_SOURCES = NEWS_SOURCES.slice(0, 5);  // Top 5 sources only
  
  const news = fetchNewsFromSources(MORNING_SOURCES);
  const summary = summarizeWithChatGPT(news, "brief");
  const weather = fetchWeatherForLocations();
  
  const body = `MORNING BRIEF
${new Date().toDateString()}
${"=".repeat(40)}

${summary}

WEATHER:
${weather}

Have a great day!
`;
  
  GmailApp.sendEmail(RECIPIENT_EMAIL, "‚òÄÔ∏è Morning Brief", body);
}

// Set trigger: Daily 6-7 AM
```

### Evening Digest (6 PM)
```javascript
function eveningDigest() {
  // Full config for evening reading
  const news = fetchNewsText();
  const summary = summarizeWithChatGPT(news, "comprehensive");
  const weather = fetchWeatherForLocations();
  const alerts = fetchAlerts();
  const markets = fetchMarketData();  // Include market close
  
  // ... build comprehensive email
}

// Set trigger: Daily 6-7 PM
```

### Weekend Edition
```javascript
function weekendReport() {
  const WEEKEND_SOURCES = [
    { name: "NYT Sunday", url: "https://rss.nytimes.com/services/xml/rss/nyt/sunday-review.xml" },
    { name: "Long Reads", url: "https://www.theguardian.com/news/series/the-long-read/rss" },
    { name: "Weekend Essays", url: "https://feeds.a.dj.com/rss/RSSOpinion.xml" }
  ];
  
  // Focus on analysis and long-form content
}

// Set trigger: Saturdays only, 9 AM
```

## üé® Custom Email Formatting

### HTML Email Template
```javascript
function sendHTMLEmail(content) {
  const htmlBody = `
<!DOCTYPE html>
<html>
<head>
  <style>
    body { font-family: 'Georgia', serif; max-width: 600px; margin: 0 auto; }
    h1 { color: #2c3e50; border-bottom: 2px solid #3498db; }
    .section { margin: 20px 0; padding: 15px; background: #f9f9f9; }
    .alert { background: #fff3cd; border-left: 4px solid #ffc107; padding: 10px; }
  </style>
</head>
<body>
  <h1>üì∞ Newsprint Daily</h1>
  ${content}
</body>
</html>
  `;
  
  GmailApp.sendEmail(RECIPIENT_EMAIL, "Daily Digest", "", {
    htmlBody: htmlBody
  });
}
```

### Markdown Format (for better Kindle rendering)
```javascript
function formatAsMarkdown(content) {
  return `
# Newsprint Daily Digest

## News Summary
${content.summary}

## Weather Forecast
${content.weather}

## Market Update
${content.markets}

---
*Generated by Newsprint*
  `;
}
```

## üìä Advanced Market Data

### Portfolio Tracking
```javascript
const PORTFOLIO = {
  AAPL: { shares: 10, cost_basis: 150 },
  GOOGL: { shares: 5, cost_basis: 120 },
  BTC: { amount: 0.5, cost_basis: 40000 }
};

function calculatePortfolioValue() {
  let totalValue = 0;
  let totalCost = 0;
  let report = ["PORTFOLIO PERFORMANCE:\n"];
  
  for (const [symbol, holding] of Object.entries(PORTFOLIO)) {
    const currentPrice = fetchCurrentPrice(symbol);
    const value = currentPrice * holding.shares;
    const cost = holding.cost_basis * holding.shares;
    const gain = value - cost;
    const gainPct = (gain / cost) * 100;
    
    totalValue += value;
    totalCost += cost;
    
    report.push(
      `${symbol}: ${holding.shares} shares @ $${currentPrice.toFixed(2)} = $${value.toFixed(2)}\n` +
      `  Cost: $${cost.toFixed(2)} | Gain: $${gain.toFixed(2)} (${gainPct.toFixed(2)}%)`
    );
  }
  
  const totalGain = totalValue - totalCost;
  const totalGainPct = (totalGain / totalCost) * 100;
  
  report.push(`\nTOTAL: $${totalValue.toFixed(2)} | Gain: $${totalGain.toFixed(2)} (${totalGainPct.toFixed(2)}%)`);
  
  return report.join("\n");
}
```

### Price Alerts
```javascript
const PRICE_ALERTS = {
  AAPL: { below: 150, above: 200 },
  BTC: { below: 50000, above: 100000 }
};

function checkPriceAlerts() {
  let alerts = [];
  
  for (const [symbol, thresholds] of Object.entries(PRICE_ALERTS)) {
    const price = fetchCurrentPrice(symbol);
    
    if (price < thresholds.below) {
      alerts.push(`üîª ${symbol} dropped below $${thresholds.below}: now $${price}`);
    }
    if (price > thresholds.above) {
      alerts.push(`üî∫ ${symbol} rose above $${thresholds.above}: now $${price}`);
    }
  }
  
  if (alerts.length > 0) {
    GmailApp.sendEmail(
      RECIPIENT_EMAIL,
      "üö® Price Alert",
      alerts.join("\n")
    );
  }
}
```

## üéØ Smart Topic Filtering

### Relevance Scoring
```javascript
function scoreArticleRelevance(article, topic) {
  let score = 0;
  
  // Title match is worth more
  if (article.title.toLowerCase().includes(topic.toLowerCase())) {
    score += 10;
  }
  
  // Description match
  if (article.description.toLowerCase().includes(topic.toLowerCase())) {
    score += 5;
  }
  
  // Boost for recent articles
  const age = (Date.now() - new Date(article.pubDate)) / (1000 * 60 * 60);
  if (age < 6) score += 5;      // Last 6 hours
  if (age < 12) score += 3;     // Last 12 hours
  
  // Boost for priority sources
  const prioritySources = ["Reuters", "Bloomberg"];
  if (prioritySources.includes(article.source)) {
    score += 3;
  }
  
  return score;
}

function getTopAlerts(allAlerts, limit = 10) {
  return allAlerts
    .map(alert => ({
      ...alert,
      score: scoreArticleRelevance(alert, alert.searchTerm)
    }))
    .sort((a, b) => b.score - a.score)
    .slice(0, limit);
}
```

### Deduplication
```javascript
function deduplicateAlerts(alerts) {
  const seen = new Set();
  return alerts.filter(alert => {
    // Create fingerprint from title
    const fingerprint = alert.title
      .toLowerCase()
      .replace(/[^a-z0-9]/g, '')
      .substring(0, 50);
    
    if (seen.has(fingerprint)) {
      return false;
    }
    
    seen.add(fingerprint);
    return true;
  });
}
```

## üìö Content Caching

### Cache Recent Fetches
```javascript
const CACHE_DURATION = 1800;  // 30 minutes in seconds

function fetchWithCache(url, cacheKey) {
  const cache = CacheService.getScriptCache();
  const cached = cache.get(cacheKey);
  
  if (cached) {
    Logger.log(`Cache hit for ${cacheKey}`);
    return JSON.parse(cached);
  }
  
  Logger.log(`Cache miss for ${cacheKey}, fetching...`);
  const response = UrlFetchApp.fetch(url);
  const data = response.getContentText();
  
  // Cache for 30 minutes
  cache.put(cacheKey, data, CACHE_DURATION);
  
  return JSON.parse(data);
}

// Usage
function fetchStockDataCached(symbol) {
  const url = `https://api.example.com/stock/${symbol}`;
  return fetchWithCache(url, `stock_${symbol}`);
}
```

## üîî Conditional Notifications

### Only Send When Important
```javascript
function smartDailyReport() {
  const news = fetchNewsText();
  const alerts = fetchAlerts();
  const markets = fetchMarketData();
  
  // Calculate importance score
  let importance = 0;
  
  if (alerts.length > 5) importance += 10;           // Many personal alerts
  if (hasLargeMarketMove(markets)) importance += 8;  // Big market moves
  if (isBreakingNews(news)) importance += 10;        // Breaking news
  
  // Only send if important enough OR it's a scheduled day
  const dayOfWeek = new Date().getDay();
  const isWeekday = dayOfWeek >= 1 && dayOfWeek <= 5;
  
  if (importance > 15 || isWeekday) {
    sendReport(news, alerts, markets);
  } else {
    Logger.log("Skipping report - not important enough");
  }
}

function hasLargeMarketMove(markets) {
  // Check if any stock moved >3%
  return markets.some(stock => Math.abs(stock.change_24h) > 3);
}
```

## üåç Geographic Filtering

### Location-Based News
```javascript
const LOCATION_KEYWORDS = {
  "New York": ["new york", "nyc", "manhattan", "brooklyn"],
  "London": ["london", "uk", "greater london"],
  "Tokyo": ["tokyo", "japan", "shinjuku", "shibuya"]
};

function filterByLocation(articles, location) {
  const keywords = LOCATION_KEYWORDS[location] || [];
  
  return articles.filter(article => {
    const text = (article.title + " " + article.description).toLowerCase();
    return keywords.some(keyword => text.includes(keyword.toLowerCase()));
  });
}
```

## üì± Multi-Channel Delivery

### Send to Multiple Destinations
```javascript
function multiChannelReport() {
  const content = buildReport();
  
  // Email to personal
  GmailApp.sendEmail(RECIPIENT_EMAIL, "Daily Digest", content.text);
  
  // Kindle for reading
  if (USE_KINDLE) {
    GmailApp.sendEmail(KINDLE_EMAIL, "Daily Digest", content.kindle);
  }
  
  // SMS for critical alerts (using external service)
  if (content.criticalAlerts.length > 0) {
    sendSMS(content.criticalAlerts);
  }
  
  // Save to Google Drive
  saveToGoogleDrive(content.full);
}
```

## üìà Analytics & Tracking

### Track Your Reading Habits
```javascript
function logMetrics() {
  const ss = SpreadsheetApp.openById('YOUR_SHEET_ID');
  const sheet = ss.getSheetByName('Metrics');
  
  sheet.appendRow([
    new Date(),
    NEWS_SOURCES.length,
    ALERT_TOPICS.length,
    getExecutionTime(),
    getNewsCount(),
    getAlertCount()
  ]);
}
```

## üîê Advanced Security

### Secure API Keys in Script Properties
```javascript
// Set once
function setApiKeys() {
  const props = PropertiesService.getScriptProperties();
  props.setProperty('OPENAI_API_KEY', 'your-key-here');
}

// Use in code
function getApiKey() {
  const props = PropertiesService.getScriptProperties();
  return props.getProperty('OPENAI_API_KEY');
}

// Then in your main code:
const OPENAI_API_KEY = getApiKey();
```

## üß™ A/B Testing Summaries

### Test Different AI Prompts
```javascript
function testSummaryPrompts() {
  const news = fetchNewsText();
  
  const prompts = [
    "Summarize these news articles concisely...",
    "Create a brief digest of the following news...",
    "Provide key takeaways from these articles..."
  ];
  
  prompts.forEach((prompt, i) => {
    const summary = summarizeWithCustomPrompt(news, prompt);
    Logger.log(`Prompt ${i+1} result length: ${summary.length}`);
    // Compare and choose best
  });
}
```

## üåü Integration Ideas

### Google Sheets Integration
```javascript
function saveToSheets() {
  const ss = SpreadsheetApp.openById('YOUR_SHEET_ID');
  const sheet = ss.getSheetByName('Daily News');
  
  const alerts = fetchAlerts();
  alerts.forEach(alert => {
    sheet.appendRow([
      new Date(),
      alert.topic,
      alert.title,
      alert.source,
      alert.url
    ]);
  });
}
```

### Slack Integration
```javascript
function sendToSlack(message) {
  const SLACK_WEBHOOK = "your-webhook-url";
  
  UrlFetchApp.fetch(SLACK_WEBHOOK, {
    method: 'post',
    contentType: 'application/json',
    payload: JSON.stringify({
      text: message
    })
  });
}
```

### Discord Integration
```javascript
function sendToDiscord(content) {
  const DISCORD_WEBHOOK = "your-webhook-url";
  
  UrlFetchApp.fetch(DISCORD_WEBHOOK, {
    method: 'post',
    contentType: 'application/json',
    payload: JSON.stringify({
      content: content,
      username: "Newsprint Bot"
    })
  });
}
```

## üéõÔ∏è Performance Optimization

### Parallel Fetching
```javascript
function fetchAllInParallel() {
  const urls = NEWS_SOURCES.map(s => s.url);
  
  // Apps Script doesn't support true parallel, but we can batch
  const requests = urls.map(url => ({
    url: url,
    muteHttpExceptions: true
  }));
  
  const responses = UrlFetchApp.fetchAll(requests);
  
  return responses.map((response, i) => ({
    source: NEWS_SOURCES[i].name,
    data: response.getContentText()
  }));
}
```

### Execution Time Monitoring
```javascript
function timedExecution() {
  const start = new Date();
  
  dailyReport();
  
  const duration = (new Date() - start) / 1000;
  Logger.log(`Execution took ${duration} seconds`);
  
  if (duration > 60) {
    Logger.log("‚ö†Ô∏è Execution taking too long, consider optimizing");
  }
}
```

## üîÑ Error Recovery

### Retry Logic
```javascript
function fetchWithRetry(url, maxRetries = 3) {
  for (let i = 0; i < maxRetries; i++) {
    try {
      const response = UrlFetchApp.fetch(url);
      return response;
    } catch (err) {
      Logger.log(`Attempt ${i+1} failed: ${err}`);
      if (i === maxRetries - 1) throw err;
      Utilities.sleep(1000 * (i + 1));  // Exponential backoff
    }
  }
}
```

### Graceful Degradation
```javascript
function robustDailyReport() {
  let news = "";
  let weather = "";
  let alerts = "";
  let markets = "";
  
  try {
    news = fetchNewsText();
  } catch (err) {
    news = "News unavailable today";
    Logger.log("News fetch failed: " + err);
  }
  
  try {
    weather = fetchWeatherForLocations();
  } catch (err) {
    weather = "Weather unavailable";
    Logger.log("Weather fetch failed: " + err);
  }
  
  // Continue with partial data...
  sendEmail(news, weather, alerts, markets);
}
```

---

## üìö Additional Resources

- [Google Apps Script Documentation](https://developers.google.com/apps-script)
- [OpenAI API Documentation](https://platform.openai.com/docs)
- [RSS Feed Specification](https://www.rssboard.org/rss-specification)
- [Apps Script Best Practices](https://developers.google.com/apps-script/guides/best-practices)

## üí° Pro Tips

1. **Start Simple**: Begin with basic config and add features gradually
2. **Monitor Costs**: Track OpenAI API usage to avoid surprises
3. **Test Thoroughly**: Use test functions before setting up triggers
4. **Version Control**: Keep copies of working configurations
5. **Document Changes**: Note what works and what doesn't
6. **Community**: Share your customizations and learn from others

---

**Remember**: Advanced features add complexity. Only implement what you'll actually use!
